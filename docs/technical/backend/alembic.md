# Alembic

[Alembic](https://alembic.sqlalchemy.org/en/latest/) ([GitHub](https://github.com/sqlalchemy/alembic]\)) is a database migration tool. 

It migrate a database to contain fields from the most recent [database models](../../../backend/src/models). This is great for us because we don't need to migrate the database manually, and in a production environment migrations (autogenerated or otherwise) can be run easily. 

## Automatically generating migrations
Alembic has the ability to automatically generate migrations. This is ideal in a development environment where models change frequently.
Provided the database has no records, we can generate migrations using the command `alembic revision --autogenerate -m 'MIGRATION_COMMENT_OR_REASON_HERE' && alembic upgrade head`.
This will both generate the migrations (`alembic revision --autogenerate -m 'MIGRATION_COMMENT_OR_REASON_HERE'`) and then deploy them to the database (`alembic upgrade head`).

If the database has records in it, it may not be possible to auto generate migrations (for example, adding a new column that is non-nullable to existing records) in which case the migrations will need to be edited manually.

Migration locations are specified [here](../../../backend/src/alembic.ini). This **must** be mounted as a Docker volume so they persist. If they do not persist you will need to clear the database/database volume and run the migrations again, which is less than ideal on a production system.

More can be read about migrations [here](https://alembic.sqlalchemy.org/en/latest/tutorial.html#create-a-migration-script)